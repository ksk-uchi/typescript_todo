# レビュー

## 指摘事項

- [Done] 既存のテストが失敗するため修正してください
  - `backend/tests/handlers/todoHandlers.int.test.ts` の GET 以外のテストケースが 403 になってしまったのでテストケースでもリクエストを送る際 token を付けるようにしてください
    - テストケースそれぞれで付与するのは実装が大変なのでどこか一か所で token をセットするようにしたいです。
- [Done] CSRF のトークンを扱うミドルウェアのテスト `backend/tests/middleware/csrf-token.test.ts` で、実在する API を実行していますが、テスト用の疑似エンドポイントを同ファイル内で作成し、テストするようにしてください。純粋にミドルウェアのみのテストを行いたいです。
- [Done] `backend/tests/middleware/csrf-token.test.ts` は `backend/tests/middleware/csrfToken.test.ts` へとファイル名変更してください。
- [Done] ToDo 一覧ページを開くと `PreflightWildcardOriginNotAllowed` というエラーになってしまうため対策をしてください
- [Do] `backend/tests/middleware/csrfToken.test.ts` に CSRFError の時のハンドリングが直接実装されていますが、この実装は `backend/src/middlewares/errorHandler.ts` に必要なのでそちらに実装してください
  - そのうえで `backend/tests/middleware/csrfToken.test.ts` は `backend/src/middlewares/errorHandler.ts` ミドルウェアも use してください
- [Q] こちら可能であれば `backend/src/app.ts` 読み込んで取得する app に疑似 API を追加してテストしたいのですが可能でしょうか？
  - 今後 app.ts に設定を増やすたびに `csrfToken.test.ts` を更新しないといけないのは避けたいです
- [Q] `backend/tests/handlers/todoHandlers.int.test.ts` の GET 以外のテストケースで毎回 `GET /todo` にリクエストを送り Cookie をセットしていますが、毎回先に別 API にリクエストを送信するのは避けたいです。API にリクエストを送る前に Cookie と X-CSRF-Token に同じ値をセットしてテストをすることはできないでしょうか？

## 注意点

- Implementation Plan, Task, Walkthrough は日本語で出力してください
- 指摘事項が `[Q]` から始まるものがあれば、すべての対応を行う前に質問に回答すること
  - その解答に応じて `[Do]` または `[Q]` から始まる指示を追記します
  - また質問に答えられた `[Q]` は `[Q(Done)]` に変更します
    - `[Q(Done)]` は質問したことをログとして残すために使用します
    - `[Q(Done)]` から始まる指示は無視してください
- 対応方法が複数考えられるものがある場合は、すべての対応を行う前に対応方法を説明し、どの方法を選択するか確認すること
  - その説明に応じて `[Do]` または `[Q]` から始まる指示を追記します
- `[Q]` から始まる指摘事項や対応方法が不明確な指摘事項がなくなったら対応を開始すること
- 指摘事項が `[Do]` から始まる場合は、指示に従い対応すること
- 指摘事項に対応する場合は1点につき1コミット作成すること
