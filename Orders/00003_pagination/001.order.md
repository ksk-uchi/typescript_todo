# ToDo 一覧ページにページネーション機能をつける

## 背景

- ToDo 一覧には `GET /todo` API の返却するデータを表示している
- `GET /todo` の返却するデータは ToDo テーブルに存在するすべてのデータである

## 対応内容

1. (backend) ToDo テーブルに `updated_at` カラムを追加する
   - `updated_at` は DEFAULT CURRENT_DATETIME で NOT NULL とする
   - 既存のデータの `updated_at` は `created_at` と同じにしてください
     - 一旦 `updated_at` を NULLABLE で作成し、既存のデータを更新したのちに NOT NULL にする必要がある場合はそのようにしてください
2. (backend) ToDo 一覧の返却データが `updated_at` の降順になるよう改修する
   - `updated_at` が同値の場合は `id` の昇順とする
   - テストも修正する
3. (backend) `GET /todo` を改修し、ページネーション機能を付ける
   - `?page=1&items_per_page=20` というクエリパラメータを許容する
   - 返却するデータは現在 `{ todo: [] }` となっているが下記のようにしたい
     ```ts
     {
       todo: [],
       meta: {
         totalCount: number,
         totalPage: number,
         currentPage: number,
         itemsPerPage: number,
         hasNext: bool,
         hasPrevious: bool
       },
     }
     ```
   - `?page=X` と指定された際、 X ページ目が存在しない場合は 404 エラーとします
   - `?items_per_page` は最大値を 100 としてバリデーションを実装してください
   - すでに実装済みの `?include_done` と併用可能とします
     - `/todo?include_done=false&page=2&items_per_page=20` と指定された場合は未完了の ToDo の 21 件目から 40 件目までを返却するようにしてください
4. (frontend) `GET /todo` の返却値が変更になるので、既存の実装をそれに合わせて改修する
   - 返却値に `meta` というキーが出現するためそれを許容する
5. (frontend) ToDo 一覧の最下部にページネーション UI を追加してください
   - 両端に 「`<<` `<` `>` `>>`」を設置し、 `<<` `>>` は最初と最後のページにジャンプするように、 `<` `>` は１ページ前後できるようにしてください
   - UI は下記のようなものでお願いします `(<< <)` や `(> >>)` は disable スタイルでお願いします
     - `(<< <) **1** 2 3 ... 100 > >>`
     - `<< < 1 **2** 3 4 ... 100  > >>`
     - `<< < 1 2 3 **4** 5 6 ... 100 > >>`
     - `<< < 1 ... 3 4 **5** 6 7 ... 100 > >>`
     - `<< < 1 ... 94 95 **96** 97 98 ... 100 > >>`
     - `<< < 1 ... 95 96 **97** 98 99 100 > >>`
     - `<< < 1 ... 97 98 **99** 100 > >>`
     - `<< < 1 ... 98 99 **100** (> >>)`
6. (frontend) ToDo 一覧の上部にある「Hide Complete」チェックボックスの操作があった場合は１ページ目を表示するようにしてください

## 作業における注意点

- Implementation Plan, Task, Walkthrough は日本語で出力してください
- テーブルに対する変更はマイグレーションファイルを作成して行うこと
  - マイグレーションは `backend/` にある `prisma` を使うこと
  - ホスト側から実行する場合は `127.0.0.1` を指定し、Shadow DB 作成のため `root` ユーザーを使用すること
  - データ損失を伴う変更がある場合は `--create-only` でファイル作成後に `deploy` する手順推奨
    - 作成: `DATABASE_URL="mysql://root:root_password@127.0.0.1:3306/todo_db" pnpm exec prisma migrate dev --name <migration_name> --create-only`
    - 適用: `DATABASE_URL="mysql://root:root_password@127.0.0.1:3306/todo_db" pnpm exec prisma migrate deploy`
    - 生成: `pnpm exec prisma generate`
  - テスト実行前にはテスト用 DB にもマイグレーションを適用（リセット）すること
    - `DATABASE_URL="mysql://root:root_password@127.0.0.1:3306/test_todo_db" pnpm exec prisma migrate reset --force`
- 対応内容の番号を振った段落ごとにコミットを作成すること

## 許可済みコマンド

以下のコマンドは毎回確認を求めずに実行してよい (SafeToAutoRun: true)

- `git status`
- `git add .`
- `git commit -m "..."`
- `git log`
- `ls -R`
- `cat ...`
- `grep ...`
- `pnpm test:local`
- `pnpm build`
- `pnpm exec prisma generate`
