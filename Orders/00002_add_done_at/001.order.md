# ToDo に Done という概念を持たせる

## 背景

- 現在の ToDo は「完了した」という概念を持っていません
- ToDo は対応後完了するものなのでその概念を持たせたいです

## 対応内容

1. (backend) ToDo テーブルに新たに `done_at` カラムを追加する
   - `done_at`: ToDo が完了した日時 (datetime, Nullable)
2. (backend) ToDo CRUD API に `done_at` を適応する
   - GET /todo
     - `done_at` も返却するようにする
     - 「完了」したものを除いた一覧と含めた一覧をそれぞれ取得できるようにする
     - `GET /todo?include_done=true` なら完了したものも含めた一覧を返す
     - `GET /todo` なら完了したものは含めずに一覧を返す
   - GET /todo/:id
     - `done_at` も返却するようにする
   - POST /todo
     - `done_at` は NULL で新規登録する
   - PUT /todo/done/:id API を新規作成する
     - `:id` に該当する ToDo 一件を「完了状態」または「未完了状態」にする
       - 「完了状態」とは `done_at` に値 `NOW()` が入っている状態を指す
       - 「未完了状態」とは `done_at` が `NULL` になっている状態を指す
       - 「完了状態」にするのか「未完了状態」にするのかはリクエストボディある `is_done (bool)` で判断する
         - `"is_done": true` なら完了状態にする
         - `"is_done": false` なら未完了状態にする
     - 新規作成する処理は `backend/src/services/todo/todoServices.ts` に記載する
     - API に対するリクエストのバリデーションは `backend/src/handlers/todoHandlers.ts` に記載する
3. (backend) テストを実装する
   - 既存の API のテストに対して `done_at` を適用する
   - `PUT /todo/done/:id API` 用のテストを新規実装する
     - 正常系のテストケース一つとバリデーションに対するテストを `backend/tests/handlers/todoHandlers.int.test.ts` に実装する
     - ロジックが正しく行えているか検証するテストを `backend/tests/services/todo/todoServices.test.ts` に実装する
4. (frontend) ToDo 一覧の上部に「完了したものを非表示にする」というチェックボックスを表示する
   - デフォルトでチェックが入った状態にする
   - チェックが取られたら再度 GET /todo を実行し完了状態の ToDo も列挙する
     - 完了状態の ToDo はそれが完了していることが視覚的にわかるようにテキストの表示色を薄くし、更新・削除のアイコンを表示しない
5. (frontend) ToDo 一覧の ToDo 一件の左端に「完了」をあらわすチェックボックスを表示する
   - チェックが付いたら ToDo を「完了状態」にする
     - 完了状態の ToDo はそれが完了していることが視覚的にわかるようにテキストの表示色を薄くし、更新・削除のアイコンを表示しない
     - 「完了したものを非表示にする」チェックボックスにチェックがあってもすぐに一覧から削除せず、ユーザがページ更新を行うまで表示したままにしておく
       - これによりユーザは誤って完了状態にしてしまった ToDo のチェックを外し未完了状態に戻すことが可能となる

## 作業における注意点

- テーブルに対する変更はマイグレーションファイルを作成して行うこと
  - マイグレーションは `backend/` にある `prisma` を使うこと
  - ホスト側から実行する場合は `127.0.0.1` を指定し、Shadow DB 作成のため `root` ユーザーを使用すること
  - データ損失を伴う変更がある場合は `--create-only` でファイル作成後に `deploy` する手順推奨
    - 作成: `DATABASE_URL="mysql://root:root_password@127.0.0.1:3306/todo_db" pnpm exec prisma migrate dev --name <migration_name> --create-only`
    - 適用: `DATABASE_URL="mysql://root:root_password@127.0.0.1:3306/todo_db" pnpm exec prisma migrate deploy`
    - 生成: `pnpm exec prisma generate`
  - テスト実行前にはテスト用 DB にもマイグレーションを適用（リセット）すること
    - `DATABASE_URL="mysql://root:root_password@127.0.0.1:3306/test_todo_db" pnpm exec prisma migrate reset --force`
- 要件の番号を振った段落ごとにコミットを作成すること

## 許可済みコマンド

以下のコマンドは毎回確認を求めずに実行してよい (SafeToAutoRun: true)

- `git status`
- `git add .`
- `git commit -m "..."`
- `git log`
- `ls -R`
- `cat ...`
- `grep ...`
- `pnpm test:local`
- `pnpm build`
- `pnpm exec prisma generate`
